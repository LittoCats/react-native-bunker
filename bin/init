#!/usr/bin/env node

var program = require('commander');
var fs = require('fs');
var fse = require('fs-extra');
var path = require('path');

require('colors');

var package = require('../package.json');

program
  .version(package.version)
  .description('这个命令必须在 react-native 项目根目录下运行。')
  .parse(process.argv);

var projRoot = path.resolve('./');

// 检查是否是 react-native 项目根目录
try {
  fs.accessSync(path.resolve(projRoot, 'node_modules', 'react-native'));
}catch(e){
  return console.log('ERROR:'.red, program.description());
}

var configPath = path.resolve(projRoot, 'bunker.yaml');
var tempPath = path.resolve(__dirname, '../defaults/bunker.yaml');

try {
  fs.accessSync(configPath, fs.constants.F_OK)
  console.log('WARN:'.yellow, 'apm.yaml already exists. You should reinit after remove it.');
  return;
}catch(e) {}

fse.copy(tempPath, configPath, function (error) {
  if (error) return console.log('ERROR:'.red, error.message);
  console.log('done');
})